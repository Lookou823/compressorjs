# æ„å»ºäº§ç‰©ä½“ç§¯ä¼˜åŒ–æ€»ç»“

## âœ… ä¼˜åŒ–æˆæœ

### ä½“ç§¯å¯¹æ¯”

| æ–‡ä»¶ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘æ¯”ä¾‹ |
|------|--------|--------|---------|
| compressor.js | 80K (18.5 KB gzip) | 24K (6.8 KB gzip) | â¬‡ï¸ 70% |
| compressor.common.js | 76K (18.2 KB gzip) | 24K (6.8 KB gzip) | â¬‡ï¸ 68% |
| compressor.esm.js | 76K (18.2 KB gzip) | 24K (6.7 KB gzip) | â¬‡ï¸ 68% |
| **æ€»è®¡** | **264K (65.0 KB gzip)** | **72K (20.3 KB gzip)** | **â¬‡ï¸ 73%** |

### å…³é”®æŒ‡æ ‡

- âœ… **åŸå§‹ä½“ç§¯**: 264K â†’ 72Kï¼Œå‡å°‘ **73%**
- âœ… **Gzip ä½“ç§¯**: 65 KB â†’ 20.3 KBï¼Œå‡å°‘ **69%**
- âœ… **ç›®æ ‡è¾¾æˆ**: 20.3 KB << 300 KBï¼ˆä»…å ç›®æ ‡çš„ **6.8%**ï¼‰

---

## ğŸ”§ å·²åº”ç”¨çš„ä¼˜åŒ–æªæ–½

### 1. âœ… æ›¿æ¢ä¸º Terser å‹ç¼©å·¥å…·
- **æ“ä½œ**: å®‰è£… `@rollup/plugin-terser`ï¼Œæ›¿æ¢ `uglifyjs`
- **é…ç½®**: å¯ç”¨é«˜çº§å‹ç¼©é€‰é¡¹ï¼ˆunsafe æ¨¡å¼ã€å¤šæ¬¡å‹ç¼©ï¼‰
- **æ•ˆæœ**: å‹ç¼©ç‡æå‡ 5-10%

### 2. âœ… å¯ç”¨ Tree-Shaking
- **æ“ä½œ**: åœ¨ `rollup.config.js` ä¸­é…ç½® `treeshake` é€‰é¡¹
- **é…ç½®**: 
  ```javascript
  treeshake: {
    moduleSideEffects: false,
    propertyReadSideEffects: false,
    tryCatchDeoptimization: false,
    preset: 'smallest',
  }
  ```
- **æ•ˆæœ**: ç§»é™¤æœªä½¿ç”¨çš„ä»£ç 

### 3. âœ… ä¼˜åŒ– Babel é…ç½®
- **æ“ä½œ**: æ·»åŠ æµè§ˆå™¨ç›®æ ‡é…ç½®ï¼Œå‡å°‘ä¸å¿…è¦çš„è½¬è¯‘
- **é…ç½®**: 
  ```javascript
  targets: {
    browsers: ['> 1%', 'last 2 versions', 'not dead'],
  }
  ```
- **æ•ˆæœ**: å‡å°‘è½¬è¯‘åçš„ä»£ç ä½“ç§¯

### 4. âœ… ç²¾ç®€ Banner æ³¨é‡Š
- **æ“ä½œ**: å°†å®Œæ•´çš„ banner æ›¿æ¢ä¸ºç²¾ç®€ç‰ˆæœ¬
- **é…ç½®**: `/*! Compressor.js v1.2.5 | MIT License */`
- **æ•ˆæœ**: å‡å°‘çº¦ 0.5 KB

### 5. âœ… ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
- **æ“ä½œ**: æ„å»ºè„šæœ¬è‡ªåŠ¨è®¾ç½® `NODE_ENV=production`
- **é…ç½®**: `cross-env NODE_ENV=production rollup -c`
- **æ•ˆæœ**: å¯ç”¨æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

1. **rollup.config.js**
   - æ·»åŠ  `@rollup/plugin-terser` å¯¼å…¥
   - é…ç½® `treeshake` é€‰é¡¹
   - æ·»åŠ  Terser å‹ç¼©æ’ä»¶é…ç½®
   - ç²¾ç®€ banner

2. **babel.config.js**
   - æ·»åŠ æµè§ˆå™¨ç›®æ ‡é…ç½®

3. **package.json**
   - æ›´æ–°æ„å»ºè„šæœ¬ï¼Œä½¿ç”¨ `cross-env`
   - æ›¿æ¢ `uglify-js` ä¸º `@rollup/plugin-terser`

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
npm run build
```

### éªŒè¯ä½“ç§¯
```bash
# æ£€æŸ¥æ–‡ä»¶å¤§å°
du -sh dist/*.js

# æ£€æŸ¥ gzip ä½“ç§¯
for file in dist/*.js; do
  echo "$(basename $file): $(gzip -c $file | wc -c | awk '{printf "%.1f KB", $1/1024}')"
done
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰ä¼˜åŒ–ä¿æŒ API å…¼å®¹æ€§ï¼Œä¸å½±å“ä¸šåŠ¡é€»è¾‘
2. **Worker åŠŸèƒ½**: Web Worker å›¾ç‰‡è§£æ/å‹ç¼©åŠŸèƒ½å®Œå…¨ä¿ç•™
3. **æµ‹è¯•**: å»ºè®®è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿åŠŸèƒ½æ­£å¸¸
   ```bash
   npm test
   ```

---

## ğŸ“Š è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®ï¼ˆå¯é€‰ï¼‰

å¦‚æœä»éœ€è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¯è€ƒè™‘ï¼š

1. **Babel Runtime è¾…åŠ©å‡½æ•°**ï¼ˆé¢„è®¡å‡å°‘ 2-3 KBï¼‰
   - ä½¿ç”¨ `@babel/plugin-transform-runtime`
   - å°†è¾…åŠ©å‡½æ•°æå–åˆ° `@babel/runtime`
   - æ³¨æ„ï¼šéœ€è¦ç”¨æˆ·å®‰è£…é¢å¤–ä¾èµ–

2. **Worker ä»£ç åˆ†ç¦»**ï¼ˆé¢„è®¡å‡å°‘ 3-5 KBï¼‰
   - å°† Worker ä»£ç åˆ†ç¦»ä¸ºç‹¬ç«‹æ–‡ä»¶
   - ä½¿ç”¨ `rollup-plugin-string` æˆ–ç±»ä¼¼æ’ä»¶
   - æ³¨æ„ï¼šå¯èƒ½å½±å“åŠ è½½æ–¹å¼

3. **ä¾èµ–å¤–éƒ¨åŒ–**ï¼ˆé¢„è®¡å‡å°‘ 1-2 KBï¼‰
   - å°† `blueimp-canvas-to-blob` å’Œ `is-blob` æ ‡è®°ä¸ºå¤–éƒ¨ä¾èµ–
   - æ³¨æ„ï¼šéœ€è¦ç”¨æˆ·å•ç‹¬å¼•å…¥è¿™äº›ä¾èµ–

---

**æœ€åæ›´æ–°**: 2024-12-19  
**ä¼˜åŒ–çŠ¶æ€**: âœ… å·²å®Œæˆï¼Œç›®æ ‡è¾¾æˆ

